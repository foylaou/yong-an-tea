# 永安の茶 - 尚未完成功能追蹤

> 最後更新：2026-02-18

## 已完成功能 ✅

- [x] 後台商品 CRUD（含自訂屬性、庫存、多尺寸圖片）
- [x] 後台商品分類管理（含階層關係）
- [x] 後台部落格管理（含分類、標籤）
- [x] 後台用戶管理（角色分配）
- [x] 後台系統設定（多分類設定）
- [x] 前台商品展示（多種版型佈局）
- [x] 前台購物車 & 願望清單（Redux 前端）
- [x] 前台部落格展示（含 Disqus 留言）
- [x] Supabase 認證 & 資料庫基礎建設
- [x] 檔案上傳基礎設施
- [x] API 路由（商品、分類、部落格、用戶、設定）

---

## 🔴 核心電商流程（最高優先）

### 1. 訂單系統（DB + API + 後台管理）
- [ ] 建立 `orders` 和 `order_items` 資料表（含 RLS 策略）
- [ ] 建立訂單 API（建立、查詢、更新狀態）
- [ ] 建立 `/admin/orders` 後台頁面（列表、篩選、詳情）
- [ ] 訂單編號自動生成
- [ ] 訂單狀態流程：待付款 → 已付款 → 出貨中 → 已完成 / 已取消

### 2. 結帳流程（前台購物車 → 下單）`依賴 #1`
- [ ] 結帳頁面重構：收件人資訊、配送方式、付款方式
- [ ] 購物車伺服器端驗證（庫存檢查、價格確認）
- [ ] 串接建立訂單 API
- [ ] 結帳成功 / 失敗頁面
- [ ] Redux 購物車與伺服器端同步

### 3. 金流支付串接（Payment Gateway）`依賴 #1, #2`
- [ ] 選擇金流服務（綠界 ECPay / 藍新 NewebPay / Stripe）
- [ ] 支付 API 串接（信用卡、ATM 轉帳、超商代碼）
- [ ] 付款回調（Webhook）處理
- [ ] 付款狀態更新到訂單
- [ ] 退款機制

### 4. 客戶帳戶系統（註冊 / 登入 / 個人中心）
- [ ] 會員註冊頁面（email + 密碼，表單驗證）
- [ ] 忘記密碼 / 重設密碼流程
- [ ] 客戶個人中心 `/account` 頁面
- [ ] 個人資料編輯
- [ ] 收件地址管理（建立 `addresses` 資料表）
- [ ] 訂單歷史查詢

---

## 🟡 重要功能（第二優先）

### 5. 購物車 & 願望清單伺服器端同步
- [ ] 建立 `cart_items` 資料表
- [ ] 建立 `wishlist_items` 資料表
- [ ] 登入後將本地資料同步到伺服器
- [ ] 多裝置同步
- [ ] 未登入用戶保留 localStorage，登入時合併

### 6. 商品變體系統（規格 / 口味 / 容量）
- [ ] 建立 `product_variants` 資料表
- [ ] 後台商品編輯頁加入變體管理
- [ ] 前台商品詳情頁支援選擇規格
- [ ] 各變體獨立庫存、價格
- [ ] SKU 對應變體

### 9. 優惠券 / 折扣碼系統
- [ ] 建立 `coupons` 資料表
- [ ] 後台 `/admin/coupons` 管理頁面
- [ ] 結帳時輸入折扣碼驗證
- [ ] 支援百分比折扣、固定金額、免運
- [ ] 可限制特定商品或分類使用

### 10. Email 通知系統
- [ ] 整合郵件服務（Resend / SendGrid / Supabase Edge Functions）
- [ ] 註冊歡迎信
- [ ] 訂單確認信
- [ ] 出貨通知信
- [ ] 忘記密碼信
- [ ] 電子報訂閱後端邏輯（前台元件已有）

### 14. 前台頁面完全動態化
- [ ] 所有商品列表頁從 Supabase 讀取
- [ ] 商品詳情頁完全由 DB 驅動
- [ ] 部落格頁面完全由 DB 驅動
- [ ] 移除不再需要的 Markdown 靜態資料
- [ ] 完成 App Router / Pages Router 過渡

---

## 🟢 增強功能（第三優先）

### 7. 後台 Banner / 橫幅廣告管理
- [ ] 建立 `banners` 資料表
- [ ] `/admin/banners` 管理頁面（CRUD）
- [ ] 上傳圖片、設定連結、排序
- [ ] 顯示時間排程（上下架）
- [ ] 前台動態讀取 Banner

### 8. SEO 管理
- [ ] 建立 `seo_metadata` 資料表
- [ ] 每個頁面 / 商品 / 部落格可自訂 title、description、OG image
- [ ] 自動產生 sitemap.xml
- [ ] 加入 JSON-LD 結構化資料（Product、Article、BreadcrumbList）
- [ ] 後台 `/admin/seo` 管理頁面
- [ ] SEO 預覽功能

### 11. 後台導覽選單管理
- [ ] 建立 `menus` 和 `menu_items` 資料表
- [ ] `/admin/menus` 管理頁面
- [ ] 支援巢狀選單（多層下拉）
- [ ] 拖拉排序
- [ ] 前台動態讀取選單

### 12. 商品評價 / 評論系統
- [ ] 建立 `product_reviews` 資料表
- [ ] 前台商品頁顯示評論列表
- [ ] 已購買用戶可留評價（1-5 星）
- [ ] 後台審核管理評論
- [ ] 商品平均評分計算與顯示

### 13. 銷售分析 / 報表儀表板 `依賴 #1`
- [ ] 銷售額圖表（日 / 週 / 月）
- [ ] 熱銷商品排行
- [ ] 訂單狀態分佈
- [ ] 客戶統計（新客 vs 回頭客）
- [ ] 營收趨勢分析

---

## 建議實作順序

```
第一階段（核心）：#1 訂單系統 → #4 客戶帳戶 → #2 結帳流程 → #3 金流串接
第二階段（強化）：#5 購物車同步 → #6 商品變體 → #14 前台動態化 → #10 Email 通知
第三階段（優化）：#9 優惠券 → #7 Banner → #8 SEO → #11 選單 → #12 評價 → #13 報表
```

---

## 目前缺失的資料表

| 資料表 | 用途 | 對應功能 |
|--------|------|----------|
| `orders` | 訂單主表 | #1 |
| `order_items` | 訂單商品明細 | #1 |
| `addresses` | 客戶收件地址 | #4 |
| `cart_items` | 伺服器端購物車 | #5 |
| `wishlist_items` | 伺服器端願望清單 | #5 |
| `product_variants` | 商品變體/規格 | #6 |
| `coupons` | 優惠券 | #9 |
| `seo_metadata` | SEO 設定 | #8 |
| `banners` | 橫幅廣告 | #7 |
| `menus` / `menu_items` | 導覽選單 | #11 |
| `product_reviews` | 商品評價 | #12 |
