# æ°¸å®‰èŒ¶åœ’ - æ•¸æ“šåº«æ¶æ§‹æ–‡æª”

## æ¦‚è¿°
æœ¬æ–‡æª”æè¿°äº†æ°¸å®‰èŒ¶åœ’é›»å•†ç¶²ç«™çš„å®Œæ•´æ•¸æ“šåº«æ¶æ§‹ï¼ŒåŒ…æ‹¬ PostgreSQL æ•¸æ“šè¡¨å’Œ Supabase Storage Bucketsã€‚

---

## ğŸ“Š æ•¸æ“šåº«è¡¨çµæ§‹ (Database Tables)

### 1. categoriesï¼ˆèŒ¶å“é¡åˆ¥è¡¨ï¼‰
å­˜å„²èŒ¶å“çš„ä¸åŒé¡åˆ¥ä¿¡æ¯ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| name | text | é¡åˆ¥åç¨±ï¼ˆè‹±æ–‡ï¼‰ | NOT NULL |
| name_zh | text | é¡åˆ¥åç¨±ï¼ˆä¸­æ–‡ï¼‰ | - |
| slug | text | URLå‹å¥½æ¨™è­˜ç¬¦ | NOT NULL, UNIQUE |
| description | text | é¡åˆ¥æè¿° | - |
| image | text | é¡åˆ¥åœ–ç‰‡URL | - |
| is_active | boolean | æ˜¯å¦å•Ÿç”¨ | DEFAULT true |
| display_order | integer | é¡¯ç¤ºé †åº | DEFAULT 0 |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- ä¸€å°å¤šï¼šä¸€å€‹é¡åˆ¥å¯ä»¥æœ‰å¤šå€‹ç”¢å“

---

### 2. productsï¼ˆç”¢å“è¡¨ï¼‰
å­˜å„²æ‰€æœ‰èŒ¶å“åŠç›¸é—œå•†å“ä¿¡æ¯ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| name | text | ç”¢å“åç¨±ï¼ˆè‹±æ–‡ï¼‰ | NOT NULL |
| name_zh | text | ç”¢å“åç¨±ï¼ˆä¸­æ–‡ï¼‰ | - |
| slug | text | URLå‹å¥½æ¨™è­˜ç¬¦ | NOT NULL, UNIQUE |
| description | text | ç”¢å“æè¿° | - |
| category_id | integer | é¡åˆ¥ID | FOREIGN KEY â†’ categories.id |
| price | numeric(10,2) | åƒ¹æ ¼ | NOT NULL |
| sale_price | numeric(10,2) | ä¿ƒéŠ·åƒ¹æ ¼ | - |
| sku | text | åº«å­˜å–®ä½ç·¨è™Ÿ | NOT NULL |
| stock | integer | åº«å­˜æ•¸é‡ | DEFAULT 0 |
| weight | real | é‡é‡ï¼ˆå…‹ï¼‰ | - |
| dimensions | jsonb | å°ºå¯¸ä¿¡æ¯ | - |
| images | text[] | ç”¢å“åœ–ç‰‡URLæ•¸çµ„ | - |
| is_active | boolean | æ˜¯å¦å•Ÿç”¨ | DEFAULT true |
| is_featured | boolean | æ˜¯å¦ç‚ºç‰¹è‰²ç”¢å“ | DEFAULT false |
| category | product_category_enum | ç”¢å“å¤§é¡ | ENUM('tea', 'accessory', 'gift') |
| metadata | jsonb | é¡å¤–å…ƒæ•¸æ“š | - |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°ä¸€ï¼šå¤šå€‹ç”¢å“å±¬æ–¼ä¸€å€‹é¡åˆ¥
- ä¸€å°å¤šï¼šä¸€å€‹ç”¢å“å¯ä»¥æœ‰å¤šå€‹å±¬æ€§
- ä¸€å°å¤šï¼šä¸€å€‹ç”¢å“å¯ä»¥å‡ºç¾åœ¨å¤šå€‹è¨‚å–®é …ç›®ä¸­
- å¤šå°å¤šï¼šç”¢å“èˆ‡æ¨™ç±¤çš„å¤šå°å¤šé—œä¿‚ï¼ˆé€šé products_tagsï¼‰

---

### 3. product_attributesï¼ˆç”¢å“å±¬æ€§è¡¨ï¼‰
å­˜å„²ç”¢å“çš„é™„åŠ å±¬æ€§ï¼Œå¦‚èŒ¶å“çš„ç”¢åœ°ã€ç™¼é…µç¨‹åº¦ç­‰ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| product_id | integer | ç”¢å“ID | NOT NULL, FOREIGN KEY â†’ products.id |
| name | text | å±¬æ€§åç¨±ï¼ˆè‹±æ–‡ï¼‰ | NOT NULL |
| name_zh | text | å±¬æ€§åç¨±ï¼ˆä¸­æ–‡ï¼‰ | - |
| value | text | å±¬æ€§å€¼ | NOT NULL |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°ä¸€ï¼šå¤šå€‹å±¬æ€§å±¬æ–¼ä¸€å€‹ç”¢å“

---

### 4. usersï¼ˆç”¨æˆ¶è¡¨ï¼‰
å­˜å„²è¨»å†Šç”¨æˆ¶ä¿¡æ¯ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | uuid | ç”¨æˆ¶ID | PRIMARY KEY, DEFAULT random |
| email | text | é›»å­éƒµä»¶ | NOT NULL, UNIQUE |
| name | text | ç”¨æˆ¶åç¨±ï¼ˆè‹±æ–‡ï¼‰ | - |
| name_zh | text | ç”¨æˆ¶åç¨±ï¼ˆä¸­æ–‡ï¼‰ | - |
| avatar_url | text | é ­åƒURL | - |
| is_admin | boolean | æ˜¯å¦ç‚ºç®¡ç†å“¡ | DEFAULT false |
| phone | varchar(20) | é›»è©±è™Ÿç¢¼ | - |
| address | jsonb | åœ°å€ä¿¡æ¯ | - |
| password_hash | text | å¯†ç¢¼é›œæ¹Š | - |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- ä¸€å°å¤šï¼šä¸€å€‹ç”¨æˆ¶å¯ä»¥æœ‰å¤šå€‹è¨‚å–®
- ä¸€å°å¤šï¼šä¸€å€‹ç”¨æˆ¶å¯ä»¥æœ‰å¤šå€‹è³¼ç‰©è»Š

---

### 5. ordersï¼ˆè¨‚å–®è¡¨ï¼‰
å­˜å„²ç”¨æˆ¶çš„è¨‚å–®ä¿¡æ¯ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| user_id | uuid | ç”¨æˆ¶ID | NOT NULL, FOREIGN KEY â†’ users.id |
| order_number | text | è¨‚å–®ç·¨è™Ÿ | NOT NULL, UNIQUE |
| status | order_status_enum | è¨‚å–®ç‹€æ…‹ | DEFAULT 'pending' |
| total | numeric(10,2) | è¨‚å–®ç¸½é‡‘é¡ | NOT NULL |
| shipping_address | jsonb | é€è²¨åœ°å€ | NOT NULL |
| billing_address | jsonb | å¸³å–®åœ°å€ | - |
| shipping_method | text | é€è²¨æ–¹å¼ | NOT NULL |
| payment_method | text | æ”¯ä»˜æ–¹å¼ | NOT NULL |
| payment_status | text | æ”¯ä»˜ç‹€æ…‹ | DEFAULT 'pending' |
| notes | text | è¨‚å–®å‚™è¨» | - |
| notes_zh | text | è¨‚å–®å‚™è¨»ï¼ˆä¸­æ–‡ï¼‰ | - |
| order_date | date | è¨‚å–®æ—¥æœŸ | NOT NULL |
| order_time | time | è¨‚å–®æ™‚é–“ | NOT NULL |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**æšèˆ‰å€¼ (order_status_enum)ï¼š** `pending`, `processing`, `shipped`, `delivered`, `cancelled`

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°ä¸€ï¼šå¤šå€‹è¨‚å–®å±¬æ–¼ä¸€å€‹ç”¨æˆ¶
- ä¸€å°å¤šï¼šä¸€å€‹è¨‚å–®åŒ…å«å¤šå€‹è¨‚å–®é …ç›®

---

### 6. order_itemsï¼ˆè¨‚å–®é …ç›®è¡¨ï¼‰
å­˜å„²è¨‚å–®ä¸­çš„æ¯å€‹ç”¢å“é …ç›®ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| order_id | integer | è¨‚å–®ID | NOT NULL, FOREIGN KEY â†’ orders.id |
| product_id | integer | ç”¢å“ID | NOT NULL, FOREIGN KEY â†’ products.id |
| quantity | integer | æ•¸é‡ | NOT NULL, DEFAULT 1 |
| unit_price | numeric(10,2) | å–®åƒ¹ | NOT NULL |
| total_price | numeric(10,2) | ç¸½åƒ¹ | NOT NULL |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°ä¸€ï¼šå¤šå€‹è¨‚å–®é …ç›®å±¬æ–¼ä¸€å€‹è¨‚å–®
- å¤šå°ä¸€ï¼šè¨‚å–®é …ç›®é—œè¯åˆ°ä¸€å€‹ç”¢å“

---

### 7. tagsï¼ˆæ¨™ç±¤è¡¨ï¼‰
ç”¨æ–¼ç”¢å“åˆ†é¡å’Œæœç´¢ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| name | text | æ¨™ç±¤åç¨±ï¼ˆè‹±æ–‡ï¼‰ | NOT NULL, UNIQUE |
| name_zh | text | æ¨™ç±¤åç¨±ï¼ˆä¸­æ–‡ï¼‰ | - |
| slug | text | URLå‹å¥½æ¨™è­˜ç¬¦ | NOT NULL, UNIQUE |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°å¤šï¼šæ¨™ç±¤èˆ‡ç”¢å“çš„å¤šå°å¤šé—œä¿‚ï¼ˆé€šé products_tagsï¼‰

---

### 8. products_tagsï¼ˆç”¢å“æ¨™ç±¤é—œè¯è¡¨ï¼‰
å¯¦ç¾ç”¢å“èˆ‡æ¨™ç±¤çš„å¤šå°å¤šé—œä¿‚ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| product_id | integer | ç”¢å“ID | NOT NULL, FOREIGN KEY â†’ products.id |
| tag_id | integer | æ¨™ç±¤ID | NOT NULL, FOREIGN KEY â†’ tags.id |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |

---

### 9. cartsï¼ˆè³¼ç‰©è»Šè¡¨ï¼‰
å­˜å„²ç”¨æˆ¶çš„è³¼ç‰©è»Šä¿¡æ¯ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | uuid | è³¼ç‰©è»ŠID | PRIMARY KEY, DEFAULT random |
| user_id | uuid | ç”¨æˆ¶ID | FOREIGN KEY â†’ users.id |
| session_id | text | æœƒè©±IDï¼ˆæœªç™»éŒ„ç”¨æˆ¶ï¼‰ | - |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°ä¸€ï¼šè³¼ç‰©è»Šå±¬æ–¼ä¸€å€‹ç”¨æˆ¶
- ä¸€å°å¤šï¼šä¸€å€‹è³¼ç‰©è»ŠåŒ…å«å¤šå€‹è³¼ç‰©è»Šé …ç›®

---

### 10. cart_itemsï¼ˆè³¼ç‰©è»Šé …ç›®è¡¨ï¼‰
å­˜å„²è³¼ç‰©è»Šä¸­çš„ç”¢å“é …ç›®ã€‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| id | serial | ä¸»éµID | PRIMARY KEY |
| cart_id | uuid | è³¼ç‰©è»ŠID | NOT NULL, FOREIGN KEY â†’ carts.id |
| product_id | integer | ç”¢å“ID | NOT NULL, FOREIGN KEY â†’ products.id |
| quantity | integer | æ•¸é‡ | NOT NULL, DEFAULT 1 |
| created_at | timestamp | å‰µå»ºæ™‚é–“ | NOT NULL |
| updated_at | timestamp | æ›´æ–°æ™‚é–“ | NOT NULL |

**é—œè¯é—œä¿‚ï¼š**
- å¤šå°ä¸€ï¼šå¤šå€‹è³¼ç‰©è»Šé …ç›®å±¬æ–¼ä¸€å€‹è³¼ç‰©è»Š
- å¤šå°ä¸€ï¼šè³¼ç‰©è»Šé …ç›®é—œè¯åˆ°ä¸€å€‹ç”¢å“

---

## ğŸ’¾ Supabase Storage Buckets

### 1. product-imagesï¼ˆç”¢å“åœ–ç‰‡ï¼‰
**ç”¨é€”ï¼š** å­˜å„²æ‰€æœ‰èŒ¶å“å’Œå•†å“çš„åœ–ç‰‡

**ç›®éŒ„çµæ§‹ï¼š**
```
product-images/
â”œâ”€â”€ main/              # ç”¢å“ä¸»åœ–
â”‚   â”œâ”€â”€ {product_id}/
â”‚   â”‚   â””â”€â”€ {image_name}.jpg
â”œâ”€â”€ gallery/           # ç”¢å“ç•«å»Šåœ–ç‰‡
â”‚   â”œâ”€â”€ {product_id}/
â”‚   â”‚   â””â”€â”€ {image_name}.jpg
â””â”€â”€ thumbnails/        # ç¸®ç•¥åœ–
    â”œâ”€â”€ {product_id}/
    â”‚   â””â”€â”€ {image_name}.jpg
```

**è¨ªå•æ¬Šé™å»ºè­°ï¼š**
- å…¬é–‹è®€å–
- åƒ…ç®¡ç†å“¡ä¸Šå‚³/åˆªé™¤

**æ–‡ä»¶é¡å‹ï¼š** JPG, PNG, WebP
**å¤§å°é™åˆ¶ï¼š** 5MB/æ–‡ä»¶

---

### 2. category-imagesï¼ˆåˆ†é¡åœ–ç‰‡ï¼‰
**ç”¨é€”ï¼š** å­˜å„²èŒ¶å“é¡åˆ¥çš„å°é¢åœ–ç‰‡

**ç›®éŒ„çµæ§‹ï¼š**
```
category-images/
â”œâ”€â”€ {category_id}/
â”‚   â””â”€â”€ cover.jpg
```

**è¨ªå•æ¬Šé™å»ºè­°ï¼š**
- å…¬é–‹è®€å–
- åƒ…ç®¡ç†å“¡ä¸Šå‚³/åˆªé™¤

**æ–‡ä»¶é¡å‹ï¼š** JPG, PNG, WebP
**å¤§å°é™åˆ¶ï¼š** 3MB/æ–‡ä»¶

---

### 3. user-avatarsï¼ˆç”¨æˆ¶é ­åƒï¼‰
**ç”¨é€”ï¼š** å­˜å„²ç”¨æˆ¶ä¸Šå‚³çš„é ­åƒåœ–ç‰‡

**ç›®éŒ„çµæ§‹ï¼š**
```
user-avatars/
â”œâ”€â”€ {user_id}/
â”‚   â””â”€â”€ avatar.jpg
```

**è¨ªå•æ¬Šé™å»ºè­°ï¼š**
- å…¬é–‹è®€å–
- ç”¨æˆ¶åªèƒ½ä¸Šå‚³/æ›´æ–°è‡ªå·±çš„é ­åƒ

**æ–‡ä»¶é¡å‹ï¼š** JPG, PNG
**å¤§å°é™åˆ¶ï¼š** 2MB/æ–‡ä»¶

---

### 4. blog-imagesï¼ˆåšå®¢åœ–ç‰‡ï¼‰
**ç”¨é€”ï¼š** å­˜å„²åšå®¢æ–‡ç« çš„é…åœ–

**ç›®éŒ„çµæ§‹ï¼š**
```
blog-images/
â”œâ”€â”€ {blog_slug}/
â”‚   â”œâ”€â”€ featured.jpg    # ç‰¹è‰²åœ–ç‰‡
â”‚   â”œâ”€â”€ content/        # æ–‡ç« å…§å®¹åœ–ç‰‡
â”‚   â”‚   â””â”€â”€ {image_name}.jpg
â”‚   â””â”€â”€ thumbnails/     # ç¸®ç•¥åœ–
â”‚       â””â”€â”€ {image_name}.jpg
```

**è¨ªå•æ¬Šé™å»ºè­°ï¼š**
- å…¬é–‹è®€å–
- åƒ…ç®¡ç†å“¡/ç·¨è¼¯ä¸Šå‚³/åˆªé™¤

**æ–‡ä»¶é¡å‹ï¼š** JPG, PNG, WebP
**å¤§å°é™åˆ¶ï¼š** 5MB/æ–‡ä»¶

---

### 5. assetsï¼ˆå…¬å…±è³‡æºï¼‰
**ç”¨é€”ï¼š** å­˜å„²ç¶²ç«™çš„å…¬å…±è³‡æºï¼ˆæ©«å¹…ã€Logoã€ä¿ƒéŠ·åœ–ç­‰ï¼‰

**ç›®éŒ„çµæ§‹ï¼š**
```
assets/
â”œâ”€â”€ banners/           # æ©«å¹…åœ–ç‰‡
â”‚   â””â”€â”€ {banner_name}.jpg
â”œâ”€â”€ logos/             # ç¶²ç«™Logo
â”‚   â””â”€â”€ {logo_variant}.svg
â”œâ”€â”€ promotions/        # ä¿ƒéŠ·åœ–ç‰‡
â”‚   â””â”€â”€ {promo_name}.jpg
â””â”€â”€ icons/             # åœ–æ¨™
    â””â”€â”€ {icon_name}.svg
```

**è¨ªå•æ¬Šé™å»ºè­°ï¼š**
- å…¬é–‹è®€å–
- åƒ…ç®¡ç†å“¡ä¸Šå‚³/åˆªé™¤

**æ–‡ä»¶é¡å‹ï¼š** JPG, PNG, WebP, SVG
**å¤§å°é™åˆ¶ï¼š** 10MB/æ–‡ä»¶

---

## ğŸ”— Mermaid ER åœ–

### æ•¸æ“šåº«é—œä¿‚åœ–

```mermaid
erDiagram
    %% ä¸»è¦å¯¦é«”è¡¨
    CATEGORIES {
        serial id PK
        text name
        text name_zh
        text slug UK
        text description
        text image
        boolean is_active
        integer display_order
        timestamp created_at
        timestamp updated_at
    }

    PRODUCTS {
        serial id PK
        text name
        text name_zh
        text slug UK
        text description
        integer category_id FK
        numeric price
        numeric sale_price
        text sku
        integer stock
        real weight
        jsonb dimensions
        text_array images
        boolean is_active
        boolean is_featured
        product_category_enum category
        jsonb metadata
        timestamp created_at
        timestamp updated_at
    }

    PRODUCT_ATTRIBUTES {
        serial id PK
        integer product_id FK
        text name
        text name_zh
        text value
        timestamp created_at
        timestamp updated_at
    }

    USERS {
        uuid id PK
        text email UK
        text name
        text name_zh
        text avatar_url
        boolean is_admin
        varchar phone
        jsonb address
        text password_hash
        timestamp created_at
        timestamp updated_at
    }

    ORDERS {
        serial id PK
        uuid user_id FK
        text order_number UK
        order_status_enum status
        numeric total
        jsonb shipping_address
        jsonb billing_address
        text shipping_method
        text payment_method
        text payment_status
        text notes
        text notes_zh
        date order_date
        time order_time
        timestamp created_at
        timestamp updated_at
    }

    ORDER_ITEMS {
        serial id PK
        integer order_id FK
        integer product_id FK
        integer quantity
        numeric unit_price
        numeric total_price
        timestamp created_at
        timestamp updated_at
    }

    TAGS {
        serial id PK
        text name UK
        text name_zh
        text slug UK
        timestamp created_at
        timestamp updated_at
    }

    PRODUCTS_TAGS {
        serial id PK
        integer product_id FK
        integer tag_id FK
        timestamp created_at
    }

    CARTS {
        uuid id PK
        uuid user_id FK
        text session_id
        timestamp created_at
        timestamp updated_at
    }

    CART_ITEMS {
        serial id PK
        uuid cart_id FK
        integer product_id FK
        integer quantity
        timestamp created_at
        timestamp updated_at
    }

    %% é—œä¿‚å®šç¾©
    CATEGORIES ||--o{ PRODUCTS : "has many"
    PRODUCTS ||--o{ PRODUCT_ATTRIBUTES : "has many"
    PRODUCTS ||--o{ ORDER_ITEMS : "appears in"
    PRODUCTS ||--o{ CART_ITEMS : "in cart"
    PRODUCTS }o--o{ TAGS : "tagged with"
    PRODUCTS_TAGS }o--|| PRODUCTS : "links"
    PRODUCTS_TAGS }o--|| TAGS : "links"
    USERS ||--o{ ORDERS : "places"
    USERS ||--o{ CARTS : "owns"
    ORDERS ||--o{ ORDER_ITEMS : "contains"
    CARTS ||--o{ CART_ITEMS : "contains"
```

### Storage Buckets æ¶æ§‹åœ–

```mermaid
graph TB
    subgraph Supabase_Storage["â˜ï¸ Supabase Storage"]
        subgraph ProductImages["ğŸ“¦ product-images"]
            PM[main/]
            PG[gallery/]
            PT[thumbnails/]
        end

        subgraph CategoryImages["ğŸ“‚ category-images"]
            CC[category covers]
        end

        subgraph UserAvatars["ğŸ‘¤ user-avatars"]
            UA[user avatars]
        end

        subgraph BlogImages["ğŸ“ blog-images"]
            BF[featured/]
            BC[content/]
            BT[thumbnails/]
        end

        subgraph Assets["ğŸ¨ assets"]
            AB[banners/]
            AL[logos/]
            AP[promotions/]
            AI[icons/]
        end
    end

    subgraph Database["ğŸ—„ï¸ PostgreSQL Database"]
        P[products table]
        C[categories table]
        U[users table]
        B[blogs table]
    end

    %% é—œè¯é—œä¿‚
    P -.stores URLs.-> PM
    P -.stores URLs.-> PG
    P -.stores URLs.-> PT
    C -.stores URLs.-> CC
    U -.stores URLs.-> UA
    B -.stores URLs.-> BF
    B -.stores URLs.-> BC

    style Supabase_Storage fill:#2ecc71,stroke:#27ae60,stroke-width:3px
    style Database fill:#3498db,stroke:#2980b9,stroke-width:3px
    style ProductImages fill:#e8f8f5,stroke:#1abc9c
    style CategoryImages fill:#fef9e7,stroke:#f39c12
    style UserAvatars fill:#ebf5fb,stroke:#3498db
    style BlogImages fill:#fef5e7,stroke:#e67e22
    style Assets fill:#fdeef4,stroke:#e91e63
```

---

## ğŸ“ å»ºè­°çš„æ“´å±•è¡¨

### blogsï¼ˆåšå®¢æ–‡ç« è¡¨ï¼‰
ç›®å‰ä»£ç¢¼ä¸­æœ‰åšå®¢åŠŸèƒ½ï¼Œä½†æ•¸æ“šåº«ä¸­æœªå®šç¾©ã€‚å»ºè­°æ·»åŠ ï¼š

```sql
CREATE TABLE blogs (
    id SERIAL PRIMARY KEY,
    slug TEXT NOT NULL UNIQUE,
    title TEXT NOT NULL,
    title_zh TEXT,
    content TEXT NOT NULL,
    excerpt TEXT,
    featured_image TEXT,
    author_id UUID REFERENCES users(id),
    category TEXT,
    tags TEXT[],
    is_published BOOLEAN DEFAULT false,
    published_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
```

### reviewsï¼ˆç”¢å“è©•è«–è¡¨ï¼‰
ç”¨æ–¼ç”¨æˆ¶å°ç”¢å“çš„è©•è«–å’Œè©•åˆ†ï¼š

```sql
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    product_id INTEGER REFERENCES products(id) NOT NULL,
    user_id UUID REFERENCES users(id) NOT NULL,
    rating INTEGER CHECK (rating >= 1 AND rating <= 5) NOT NULL,
    title TEXT,
    comment TEXT,
    is_verified_purchase BOOLEAN DEFAULT false,
    is_approved BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
```

### wishlistï¼ˆé¡˜æœ›æ¸…å–®è¡¨ï¼‰
ç”¨æˆ¶æ”¶è—å–œæ„›çš„ç”¢å“ï¼š

```sql
CREATE TABLE wishlist (
    id SERIAL PRIMARY KEY,
    user_id UUID REFERENCES users(id) NOT NULL,
    product_id INTEGER REFERENCES products(id) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW() NOT NULL,
    UNIQUE(user_id, product_id)
);
```

---

## ğŸ”’ å®‰å…¨å»ºè­°

### Row Level Security (RLS) ç­–ç•¥

#### 1. users è¡¨
```sql
-- ç”¨æˆ¶åªèƒ½è®€å–å’Œæ›´æ–°è‡ªå·±çš„è³‡æ–™
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own data"
    ON users FOR SELECT
    USING (auth.uid() = id);

CREATE POLICY "Users can update own data"
    ON users FOR UPDATE
    USING (auth.uid() = id);
```

#### 2. orders è¡¨
```sql
-- ç”¨æˆ¶åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è¨‚å–®
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own orders"
    ON orders FOR SELECT
    USING (auth.uid() = user_id);
```

#### 3. carts è¡¨
```sql
-- ç”¨æˆ¶åªèƒ½æ“ä½œè‡ªå·±çš„è³¼ç‰©è»Š
ALTER TABLE carts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own cart"
    ON carts FOR ALL
    USING (auth.uid() = user_id);
```

### Storage Bucket å®‰å…¨ç­–ç•¥

#### product-images
```sql
-- å…¬é–‹è®€å–ï¼Œåƒ…ç®¡ç†å“¡ä¸Šå‚³
CREATE POLICY "Public read access"
    ON storage.objects FOR SELECT
    USING (bucket_id = 'product-images');

CREATE POLICY "Admin upload access"
    ON storage.objects FOR INSERT
    WITH CHECK (
        bucket_id = 'product-images'
        AND auth.jwt()->>'role' = 'admin'
    );
```

#### user-avatars
```sql
-- ç”¨æˆ¶åªèƒ½ä¸Šå‚³è‡ªå·±çš„é ­åƒ
CREATE POLICY "Users can upload own avatar"
    ON storage.objects FOR INSERT
    WITH CHECK (
        bucket_id = 'user-avatars'
        AND (storage.foldername(name))[1] = auth.uid()::text
    );
```

---

## ğŸ“‹ ç´¢å¼•å»ºè­°

ç‚ºäº†å„ªåŒ–æŸ¥è©¢æ€§èƒ½ï¼Œå»ºè­°æ·»åŠ ä»¥ä¸‹ç´¢å¼•ï¼š

```sql
-- Products è¡¨
CREATE INDEX idx_products_category_id ON products(category_id);
CREATE INDEX idx_products_slug ON products(slug);
CREATE INDEX idx_products_is_active ON products(is_active);
CREATE INDEX idx_products_is_featured ON products(is_featured);

-- Orders è¡¨
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_order_date ON orders(order_date DESC);

-- Order Items è¡¨
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);

-- Product Attributes è¡¨
CREATE INDEX idx_product_attributes_product_id ON product_attributes(product_id);

-- Products Tags è¡¨
CREATE INDEX idx_products_tags_product_id ON products_tags(product_id);
CREATE INDEX idx_products_tags_tag_id ON products_tags(tag_id);

-- Cart Items è¡¨
CREATE INDEX idx_cart_items_cart_id ON cart_items(cart_id);
CREATE INDEX idx_cart_items_product_id ON cart_items(product_id);
```

---

## ğŸš€ éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### æ•¸æ“šåº«è¨­ç½®
- [ ] å‰µå»ºæ‰€æœ‰å¿…è¦çš„è¡¨
- [ ] è¨­ç½®é©ç•¶çš„ç´¢å¼•
- [ ] é…ç½® Row Level Security ç­–ç•¥
- [ ] è¨­ç½®æ•¸æ“šåº«å‚™ä»½ç­–ç•¥
- [ ] é…ç½®é€£æ¥æ± è¨­ç½®

### Storage è¨­ç½®
- [ ] å‰µå»ºæ‰€æœ‰å¿…è¦çš„ Buckets
- [ ] é…ç½® Bucket è¨ªå•ç­–ç•¥
- [ ] è¨­ç½®æ–‡ä»¶å¤§å°é™åˆ¶
- [ ] é…ç½®å…è¨±çš„æ–‡ä»¶é¡å‹
- [ ] è¨­ç½® CDN ç·©å­˜ç­–ç•¥

### å®‰å…¨è¨­ç½®
- [ ] å•Ÿç”¨ SSL/TLS é€£æ¥
- [ ] é…ç½®ç’°å¢ƒè®Šé‡ï¼ˆä¸è¦ç¡¬ç·¨ç¢¼æ•æ„Ÿä¿¡æ¯ï¼‰
- [ ] è¨­ç½®é©ç•¶çš„ CORS ç­–ç•¥
- [ ] é…ç½® API é€Ÿç‡é™åˆ¶
- [ ] å•Ÿç”¨æ—¥èªŒç›£æ§

---

## ğŸ“ ç›¸é—œæ–‡æª”éˆæ¥

- [Supabase å®˜æ–¹æ–‡æª”](https://supabase.com/docs)
- [Drizzle ORM æ–‡æª”](https://orm.drizzle.team/)
- [PostgreSQL æ–‡æª”](https://www.postgresql.org/docs/)
- [Row Level Security æŒ‡å—](https://supabase.com/docs/guides/auth/row-level-security)

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** 1.0
**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-08
**ç¶­è­·è€…ï¼š** æ°¸å®‰èŒ¶åœ’é–‹ç™¼åœ˜éšŠ
